<!DOCTYPE html>
<!--繁體中文-->
<html lang="zh-Hant">

<head>
	<link rel="stylesheet" type="text/css" href="../../resources/datetimepicker/jquery.datetimepicker.css" />
	<link rel="shortcut icon" href="assets/images/logo/favicon.svg" type="image/x-icon">
	<link rel="shortcut icon" href="assets/images/logo/favicon.png" type="image/png">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.7/dist/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="../../resources/back-end/assets/css/main/app.css">
    <meta charset="UTF-8">
    <!-- 定義為RWD web -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 最佳兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <!-- 防止搜索引擎索引及檢索 -->
    <meta name="robots" content="noindex,nofollow">

    <!-- !!固定!! 後台樣板 css start -->
    <link rel="stylesheet" href="../../resources/back-end/assets/css/main/app.css">
    <!-- !!固定!! 後台樣板 css end -->

    <!-- favicon 網址列小圖示 -->
    <link rel="shortcut icon" href="../../resources/back-end/assets/images/main/favicons/favicon2.ico" type="image/x-icon">

<!--    需要用自己的css請放在這邊註解下方覆蓋 start -->
<style>
	.btn{
		margin-left: 10px;
	}
	.form-select {
		width:11%;
		display: inline-block;
	}
	.btn-primary{
		margin-left: 400px;
	}
</style>



<!--    自己的css end-->
<!--    網址列標題-->
    <title>陪你e生e世　社區服務平台</title>
    <!-- !!固定!! 旁邊導覽列sidebar menu start -->
    <script src="../../resources/back-end/assets/js/sidebar.js"></script>
    <!-- !!固定!! 旁邊導覽列sidebar menu end -->
</head>

<body>

<!--!!固定!! 這邊以下是右上方放登出+通知等等的 navbar 使用的樣板格式(目前為假資料)-->
<div id="main" class='layout-navbar'>
                <header class='mb-3'>
                    <nav class="navbar navbar-expand navbar-light navbar-top">
                        <div class="container-fluid">
                            <a href="#" class="burger-btn d-block">
                                <i class="bi bi-justify fs-3"></i>
                            </a>

                            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                                    aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                <ul class="navbar-nav ms-auto mb-lg-0">
                                    <li class="nav-item dropdown me-1">
                                        <a class="nav-link active dropdown-toggle text-gray-600" href="#" data-bs-toggle="dropdown"
                                           aria-expanded="false">
                                            <i class='bi bi-envelope bi-sub fs-4'></i>
                                        </a>
                                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                                            <li>
                                                <h6 class="dropdown-header">Mail</h6>
                                            </li>
                                            <li><a class="dropdown-item" href="#">No new mail</a></li>
                                        </ul>
                                    </li>
                                    <li class="nav-item dropdown me-3">
                                        <a class="nav-link active dropdown-toggle text-gray-600" href="#" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false">
                                            <i class='bi bi-bell bi-sub fs-4'></i>
                                        </a>
                                        <ul class="dropdown-menu dropdown-menu-end notification-dropdown" aria-labelledby="dropdownMenuButton">
                                            <li class="dropdown-header">
                                                <h6>Notifications</h6>
                                            </li>
                                            <li class="dropdown-item notification-item">
                                                <a class="d-flex align-items-center" href="#">
                                                    <div class="notification-icon bg-primary">
                                                        <i class="bi bi-cart-check"></i>
                                                    </div>
                                                    <div class="notification-text ms-4">
                                                        <p class="notification-title font-bold">Successfully check out</p>
                                                        <p class="notification-subtitle font-thin text-sm">Order ID #256</p>
                                                    </div>
                                                </a>
                                            </li>
                                            <li class="dropdown-item notification-item">
                                                <a class="d-flex align-items-center" href="#">
                                                    <div class="notification-icon bg-success">
                                                        <i class="bi bi-file-earmark-check"></i>
                                                    </div>
                                                    <div class="notification-text ms-4">
                                                        <p class="notification-title font-bold">Homework submitted</p>
                                                        <p class="notification-subtitle font-thin text-sm">Algebra math homework</p>
                                                    </div>
                                                </a>
                                            </li>
                                            <li>
                                                <p class="text-center py-2 mb-0"><a href="#">See all notification</a></p>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                                <div class="dropdown">
                                    <a href="#" data-bs-toggle="dropdown" aria-expanded="false">
                                        <div class="user-menu d-flex">
                                            <div class="user-name text-end me-3">
                                                <h6 class="mb-0 text-gray-600">管理員名</h6>
                                                <p class="mb-0 text-sm text-gray-600">Administrator</p>
                                            </div>
                                            <div class="user-img d-flex align-items-center">
                                                <div class="avatar avatar-md">
                                                    <img src="">
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton" style="min-width: 11rem;">
                                        <li>
                                            <h6 class="dropdown-header">Hello!</h6>
                                        </li>
                                        <li><a class="dropdown-item" href="#"><i class="icon-mid bi bi-person me-2"></i> My
                                            Profile</a></li>
                                        <li><a class="dropdown-item" href="#"><i class="icon-mid bi bi-gear me-2"></i>
                                            Settings</a></li>
                                        <li><a class="dropdown-item" href="#"><i class="icon-mid bi bi-wallet me-2"></i>
                                            Wallet</a></li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>
                                        <li><a class="dropdown-item" href="#"><i
                                                class="icon-mid bi bi-box-arrow-left me-2"></i> Logout</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </nav>
                </header>
                <!-- !!固定!! 右上方 navbar end -->

    <!-- 頁面 START!　網頁請從這邊以下開始修改，不需要此格式想用自己的請刪除 ~　-->

            <div id="main-content">
                    <div class="page-heading">
                        <div class="page-title">
                            <div class="row">
                                <div class="col-12 col-md-6 order-md-1 order-last">
                                    <h3>郵件管理</h3>
                                </div>
                                <div class="col-12 col-md-6 order-md-2 order-first">
                                    <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="../web/backEndHome.html">Home</a></li>
                                            <li class="breadcrumb-item active" aria-current="page">Mail Management</li>
                                        </ol>
                                    </nav>
                                </div>
                            </div>
                        </div>
                        <section class="section">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title"></h4>
                                </div>
                                <div class="card-body">
                                
	                               	<div>
										<select id="select_mailType" name="select_mailType"  class="form-select">
											<option style="display: none;">請選擇</option>
										</select>
								        <input type="text" id="search_mailID" placeholder="輸入郵件編號"> <input type="button" id="searchMail" value="搜尋">
								   		<button id="addMail" class="btn btn-primary">新增郵件</button>
								   </div>
                                   <div id="showAllMail" class="showAllMail">
										<table id="getAllMail" class='table table_sm'>
											<tr>
												<th>郵件編號</th>
												<th>住戶編號</th>
												<th>郵件項目</th>
												<th>郵件到達日期</th>
												<th>郵件領取日期</th>
												<th>郵件狀態</th>
												<th>修改</th>
												<th>刪除</th>
											</tr>
											<tr id="allMail">
						
											</tr>
										</table>

                                	</div>
                                </div>
                            </div>
                        </section>
        </div>
<!--        頁面 END-->


<!--        !!固定!! footer(擺每個頁面最下方的版權用) START-->
            <footer>
                <div class="footer clearfix mb-0 text-muted">
                    <div class="float-start">
                        <p>2022 &copy; 陪你e生e世　社區服務平台</p>
                    </div>
                    <div class="float-end">
                        <p>Community Management</p>
                    </div>
                </div>
            </footer>
<!--        !!固定!! footer END-->
                </div>
            </div>

<!-- 樣板用js start -->
<script src="../../resources/back-end/assets/js/bootstrap.js"></script>
<script src="../../resources/back-end/assets/js/app.js"></script>
<!-- 樣板用js end -->

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
	<script src="../../resources/datetimepicker/jquery.js"></script>
	<script src="../../resources/datetimepicker/jquery.datetimepicker.full.js"></script>
	<script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
<!-- 	<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.0.0/sweetalert2.all.js"></script> -->
<!-- 	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script> -->
<!-- 	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script> -->
<!-- 	<script type="text/javascript"></script> -->

	<script>
	
	//  =====================================新增郵件=============================================	
		window.addEventListener("load", function () {
	        document.getElementById("addMail").onclick = function(){
	        	Swal.fire({
    	            title: "新增郵件",
    	            html:"<div id='showAddMail' class='showAddMail'>"
//     					+"<table class='content'><tr><td>查詢住戶編號:</td><td>"
//     					+"<input type='text' name='memberName' placeholder='請輸入住戶姓名'>"
//     					+"<input type='submit' value='搜尋'></td></tr></table></div>"
    				    +"<table class='table table_sm'>"
    				    +"<tr><td>住戶編號:</td>"
    				    +"<td><input type='text' id='addMemberId' name='addMemberId' ></td></tr>"
    				    +"<tr><td>郵件項目:</td>"
    				    +"<td><label for='pack'>"
    			        +"<input type='radio' id='pack' name='addMailType' value='包裹' checked>包裹</label>"
    			        +"<label for='registered'><input type='radio' id='registered' name='addMailType' value='掛號'>掛號"
    			        +"</label> </td></tr>"
    				    +"<tr><td>郵件到達日期:</td>"
    				    +"<td><input type='text' id='addMailDelTime' name='addMailDelTime'></td></tr></table>"
    					+"</div>",
    	            confirmButtonColor:'#3085d6',
    	        	confirmButtonText:'確定',
    	        	showCancelButton:true,
    	        	cancelButtonText:'取消',
    	        	cancelButtonColor:'#d33',
    	        	showLoaderOnConfirm: true,
    	        	
    	        	preConfirm: function(result){
    	        		
    	        		let addMemberId = document.getElementById('addMemberId').value,
    	        			addMailType = $("[name='addMailType']:checked").val() ,
    	        			addMailDelTime = document.getElementById('addMailDelTime').value,
    	        			reminderInfo = "您的有新的郵件";
    	        			reminderStatus = "0";
    	        			
    	        		if (addMemberId === "") {
    	                	Swal.showValidationMessage('住戶編號請勿空白');
    	        		}else if(addMailDelTime ===""){
    	        			Swal.showValidationMessage('郵件到達日期請勿空白');
    	        		}else{
    	        			
    	        			var MyPoint = "/TogetherWS/james";
        	        		var host = window.location.host;
        	        		var path = window.location.pathname;
        	        		var webCtx = path.substring(0, path.indexOf('/', 1));
        	        		var endPointURL = "ws://" + window.location.host + webCtx + MyPoint;
        	        		var webSocket;
							webSocket = new WebSocket(endPointURL);
							
    	        			webSocket.onopen = function(event) {
    	        				var json = {
   	  								"message" : "您的有新的郵件"
   	  							};
   	  							webSocket.send(JSON.stringify(json));
    	        			};
    	        			return{
	        	    				memberId: addMemberId,
	        	    				mailType: addMailType,
 	        	    				mailDelTime: addMailDelTime,
 	        	    				reminderInfo:reminderInfo,
 	        	    				reminderStatus: reminderStatus
        	    			}
    	        		}
    	        		
    	        		
    	        	}
    	       
    	        }).then(async function(result){
    	        	try{
    	        		if(result.isConfirmed){
    	        			await fetch('../../back-end/mail/mail.do?action=insert', {
    	    					method: 'post',
    	    					headers: {
    	    						'Content-Type': 'application/json'
    	    					},
    	    					body: JSON.stringify(result)
    	    					
    	    				})
    	        			await fetch('../../reminder/ReminderServlet?action=insert', {
    	    					method: 'post',
    	    					headers: {
    	    						'Content-Type': 'application/json'
    	    					},
    	    					body: JSON.stringify(result)
    	    					
    	    				})
	    	        			refresh();
    	        		}
    	        	}catch(e){
    	        		alert(e);
    	        	}
    	        });
	        	
        		$.datetimepicker.setLocale('zh');
	            	$('#addMailDelTime').datetimepicker({
		       		       theme: '',              //theme: 'dark',
		       		       timepicker:false,       //timepicker:true,
		       		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
		       		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
	       	     	});
	            	
	        };
	        
	    }, false);
		
		
//     =====================================顯示AllMail=============================================
		window.addEventListener("load", async function (){
	            
	       	await fetch('../../back-end/mail/mail.do?action=getAll', {
				method: 'get'
			})
			.then(res => res.json())	
			.then(res =>{
				showMail(res);
			})
		})
		 
		 async function showMail(json){
	        	let mail = json;
	        	for(let i = 0; i < mail.length ; i++){
	        		let str = null;
	            	str+= "<tr><td>" + mail[i].mailId + "</td>"
	            	+"<td>" + mail[i].memberId + "</td>"
	            	+"<td>" + mail[i].mailType + "</td>"
	            	+"<td>" + mail[i].mailDelTime + "</td>"
	            	+"<td>" + ((mail[i].mailPickupTime === undefined)? " ": mail[i].mailPickupTime) +"</td>"
	            	+"<td value='"+ mail[i].mailState + "'>" + mail[i].mailStateName + "</td>"
					+"<td><button id='update'>修改</button></div></td>"
		        	+"<td><input type='button' id='delete' value='刪除'></td>";
	            	$("#allMail").after(str); 
//     =====================================修改=============================================  		
	            	
	            document.getElementById('update').addEventListener('click', function(){
	            		
            		Swal.fire({
        	            title: "修改郵件",
        	            html:"<table id='table-2' class='table table_sm'>"
        	           	+ "<tr><td>郵件編號:</td>"
        	            +"<td><input type='TEXT' id='updateMailId' size='10' value='"+ mail[i].mailId +"' disabled='true'></td></tr>"
        	            +"<tr><td>住戶編號:</td>"
        	            +"<td><input type='TEXT' id='updateMemberId' size='10' value='"+ mail[i].memberId +"'></td></tr>"
        	            +"<tr><td>郵件項目:</td>"
    				    +"<td><label for='pack'>"
    			        +"<input type='radio' id='pack' name='updateMailType' value='包裹'"+((mail[i].mailType === '包裹')? 'checked':'')+">包裹</label>"
    			        +"<label for='registered'>"
    			        +"<input type='radio' id='registered' name='updateMailType' value='掛號'"+((mail[i].mailType === '掛號')? 'checked':'')+">掛號"
    			        +"</label></td></tr>"
        	            +"<tr><td>郵件到達日期:</td>"
        	            +"<td><input type='TEXT' id='updateMailDelTime' value='"+ mail[i].mailDelTime +"'></td></tr>"
        	            +"<tr><td>郵件取貨日期:</td>"
        	            +"<td><input type='TEXT' id='updateMailPickupTime' value='"+ ((mail[i].mailPickupTime === undefined)? " ": mail[i].mailPickupTime) +"'></td></tr>"
        	            +"<tr><td>郵件狀態:</td>"
        	            +"<td><label for='unaccalimed'>"
        	            +"<input type='radio' id='unaccalimed' name='updateMailState' value='0'"+((mail[i].mailState === 0)? 'checked':'')+">未領取"
        	            +"</label><label for='received'>"
        	            +"<input type='radio' id='received' name='updateMailState' value='1'"+((mail[i].mailState === 1)? 'checked':'')+">已領取"
        	            +"</label><label for='returning'>"
        	            +"<input type='radio' id='returning' name='updateMailState' value='2'"+((mail[i].mailState === 2)? 'checked':'')+">退貨中"
        	            +"</label>"
        	            +"<label for='returnComplete'>"
        	            +"<input type='radio' id='returnComplete' name='updateMailState' value='3'"+((mail[i].mailState === 3)? 'checked':'')+">退貨完成"
        	            +"</label>"
        	            +" </td>",
        	            confirmButtonColor:'#3085d6',
        	        	confirmButtonText:'確定',
        	        	showCancelButton:true,
        	        	cancelButtonText:'取消',
        	        	cancelButtonColor:'#d33',
        	        	
        	        	preConfirm: function(){
        	        		
        	        		let updateMailId = document.getElementById('updateMailId').value,
        	        			updateMemberId = document.getElementById('updateMemberId').value,
        	        			updateMailType = $("input[name='updateMailType']:checked").val(),
        	        			updateMailDelTime = document.getElementById('updateMailDelTime').value,
        	        			updateMailPickupTime = document.getElementById('updateMailPickupTime').value,
        	        			updateMailState = $("input[name='updateMailState']:checked").val();
        	        		
        	        		
        	        		if(updateMemberId === ""){
        	        			Swal.showValidationMessage('住戶編號請勿空白');
        	        			
        	        		}else if(updateMailDelTime === ""){
        	        			Swal.showValidationMessage('郵件到達日期請勿空白');
        	        			
        	        		}else{
	 	        	    		return{
	 	        	    			mailId: updateMailId,
	 	        	    			memberId: updateMemberId,
	 	        	    			mailType: updateMailType,
	 	        	    			mailDelTime: updateMailDelTime,
	 	        	    			mailPickupTime: updateMailPickupTime,
	 	        	    			mailState: updateMailState
        	        			}
        	        		
	        	    		}
        	        	}
        	       
        	        }).then(async function(result){
        	        	try{
        	        		if(result.isConfirmed){
        	        			 await fetch('../../back-end/mail/mail.do?action=update', {
        	    					method: 'post',
        	    					headers: {
        	    						'Content-Type': 'application/json'
        	    					},
        	    					body: JSON.stringify(result)
        	    				});
        	        			window.location.reload(); 
        	        		}
        	        	}catch(e){
        	        		alert(e);
        	        	}
        	        });
            		
            		$.datetimepicker.setLocale('zh');
   	            	$('#updateMailDelTime').datetimepicker({
   		       		       theme: '',              //theme: 'dark',
   		       		       timepicker:false,       //timepicker:true,
   		       		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
   		       		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
   	       	     	});
  	            	
   	            	$('#updateMailPickupTime').datetimepicker({
   		       		       theme: '',              //theme: 'dark',
   		       		       timepicker:false,       //timepicker:true,
   		       		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
   		       		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
   	       	     	});	
       	        });
	            
            	//=====================================刪除=============================================
            	
            	let actionDelete = document.getElementById("delete");
            	actionDelete.addEventListener("click", function(){
            		
            		const swalWithBootstrapButtons = Swal.mixin({
            			  customClass: {
            			    confirmButton: 'btn btn-success',
            			    cancelButton: 'btn btn-danger'
            			  },
            			  buttonsStyling: false
            			})

            			swalWithBootstrapButtons.fire({
            			  title: '確定要刪除嗎?',
            			  icon: 'warning',
            			  confirmButtonText: '確定',
            			  cancelButtonText: '取消',
            			  showCancelButton: true
            			}).then((result) => {
            			  if (result.isConfirmed) {
            			    fetch('../../back-end/mail/mail.do?action=delete&mailId='+ mail[i].mailId, {method: 'get',});
            			  }
            			  window.location.reload(); 
            			}) 
            	});  
            	
            	
	        }
		 }
	//  =====================================搜尋=============================================		
		 window.addEventListener("load", async function (){
		    let res = await fetch("../../back-end/mail/mail.do?action=select_mailType", { method: 'get' })
		    data = await res.json()
			data.forEach(type => {
				$("#select_mailType").append(`<option value=${type.mailType}>${type.mailType}</option>`);	
			})
		 })
		
		
		document.getElementById("searchMail").onclick = async function searchMail(){
			rest();
			let select_mailType = $("#select_mailType").val();
			let search_mailID = $("#search_mailID").val();
			if(search_mailID === ""){
				search_mailID = 0;
			}
			
			let res = await fetch(`../../back-end/mail/mail.do?action=search&mailType=${select_mailType}&mailId=${search_mailID}`, { method: 'get' });
			let data = await res.json();
			 
			$("#showAllMail").append(
					`
					<table id="getAllMail" class='table table_sm'>
					<tr>
					<th>郵件編號</th>
					<th>住戶編號</th>
					<th>郵件項目</th>
					<th>郵件到達日期</th>
					<th>郵件領取日期</th>
					<th>郵件狀態</th>
					<th>修改</th>
					<th>刪除</th>
					</tr>
					<tr id="allMail">
					</tr>
					</table>
					<div><input type='button' id='backButton' value='回首頁'></div>`),

					 
					 
			data.forEach(mail => {
				$("#allMail").after(
					`<tr><td> ${mail.mailId} </td>
			    	<td> ${mail.memberId} </td>
			    	<td> ${mail.mailType} </td>
			    	<td> ${mail.mailDelTime} </td>
			    	<td> ${mail.mailPickupTime === undefined ? "": mail.mailPickupTime} </td>
			    	<td value='${mail.mailState}'> ${mail.mailStateName} </td>
					<td><button id='update'>修改</button></td>
			    	<td><input type='button' id='delete' value='刪除'></td></tr>`)
			   
		 //=====================================修改=============================================  		
	         document.getElementById('backButton').addEventListener('click', function(){
	        	 window.location.reload(); 
	         })
	         
            document.getElementById('update').addEventListener('click', function(){
           		Swal.fire({
       	            title: "修改郵件",
       	            html:"<table id='table-2'>"
       	           	+ "<tr><td>郵件編號:</td>"
       	            +"<td><input type='TEXT' id='updateMailId' size='45' value='"+ mail.mailId +"' disabled='true'></td></tr>"
       	            +"<tr><td>住戶編號:</td>"
       	            +"<td><input type='TEXT' id='updateMemberId' size='45' value='"+ mail.memberId +"'></td></tr>"
       	        	+"<tr><td>郵件項目:</td>"
				    +"<td><label for='pack'>"
			        +"<input type='radio' id='pack' name='updateMailType' value='包裹'>包裹</label>"
			        +"<label for='registered'>"
			        +"<input type='radio' id='registered' name='updateMailType' value='掛號'>掛號"
			        +"</label></td></tr>"
       	            +"<tr><td>郵件到達時間:</td>"
       	            +"<td><input type='TEXT' id='updateMailDelTime' value='"+ mail.mailDelTime +"'></td></tr>"
       	            +"<tr><td>郵件取貨日期:</td>"
       	            +"<td><input type='TEXT' id='updateMailPickupTime' value='"+ ((mail.mailPickupTime === undefined) ? "": mail.mailPickupTime) +"'></td></tr>"
      	        	+"<tr><td>郵件狀態:</td>"
		            +"<td><label for='unaccalimed'>"
		            +"<input type='radio' id='unaccalimed' name='updateMailState' value='0' checked>未領取"
		            +"</label><label for='received'>"
		            +"<input type='radio' id='received' name='updateMailState' value='1'>已領取"
		            +"</label><label for='returning'>"
		            +"<input type='radio' id='returning' name='updateMailState' value='2'>退貨中"
		            +"</label>"
		            +"<label for='returnComplete'>"
		            +"<input type='radio' id='returnComplete' name='updateMailState' value='3'>退貨完成"
		            +"</label>"
		            +" </td></table>",
       	            confirmButtonColor:'#3085d6',
       	        	confirmButtonText:'確定',
       	        	showCancelButton:true,
       	        	cancelButtonText:'取消',
       	        	cancelButtonColor:'#d33',
       	        	
       	        	preConfirm: function(){
       	        		let updateMailId = document.getElementById('updateMailId').value,
       	        			updateMemberId = document.getElementById('updateMemberId').value,
       	        			updateMailType = $("input[name='updateMailType']:checked").val(),
       	        			updateMailDelTime = document.getElementById('updateMailDelTime').value,
       	        			updateMailPickupTime = document.getElementById('updateMailPickupTime').value,
       	        			updateMailState = $("input[name='updateMailState']:checked").val();
       	        		
       	       
    	        		if(updateMemberId === ""){
    	        			Swal.showValidationMessage('住戶編號請勿空白');
    	        			
    	        		}else if(updateMailDelTime === ""){
    	        			Swal.showValidationMessage('郵件到達日期請勿空白');
    	        		}else{
	        	    		return{
	        	    			mailId: updateMailId,
	        	    			memberId: updateMemberId,
	        	    			mailType: updateMailType,
	        	    			mailDelTime: updateMailDelTime,
	        	    			mailPickupTime: updateMailPickupTime,
	        	    			mailState: updateMailState
	       	    			}
    	        		}
       	        	}
       	       
       	        }).then(async function(result){
       	        	try{
       	        		if(result.isConfirmed){
       	        			 await fetch('../../back-end/mail/mail.do?action=update', {
       	    					method: 'post',
       	    					headers: {
       	    						'Content-Type': 'application/json'
       	    					},
       	    					body: JSON.stringify(result)
       	    				});
       	        			searchMail();
       	        		}
       	        	}catch(e){
       	        		alert(e);
       	        	}
       	        });
           		
           		$.datetimepicker.setLocale('zh');
  	            	$('#updateMailDelTime').datetimepicker({
  		       		       theme: '',              //theme: 'dark',
  		       		       timepicker:false,       //timepicker:true,
  		       		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
  		       		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
  	       	     	});
 	            	
  	            	$('#updateMailPickupTime').datetimepicker({
  		       		       theme: '',              //theme: 'dark',
  		       		       timepicker:false,       //timepicker:true,
  		       		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
  		       		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
  	       	     	});	
      	        });
            
           	//=====================================刪除=============================================
           	
           	let actionDelete = document.getElementById("delete");
           	actionDelete.addEventListener("click", function(){
           		
           		const swalWithBootstrapButtons = Swal.mixin({
           			  customClass: {
           			    confirmButton: 'btn btn-success',
           			    cancelButton: 'btn btn-danger'
           			  },
           			  buttonsStyling: false
           			})

           			swalWithBootstrapButtons.fire({
           			  title: '確定要刪除嗎?',
           			  icon: 'warning',
           			  confirmButtonText: '確定',
           			  cancelButtonText: '取消',
           			  showCancelButton: true
           			}).then((result) => {
           			  if (result.isConfirmed) {
           			    fetch('../../back-end/mail/mail.do?action=delete&mailId='+ mail[i].mailId, {method: 'get',});
           			  }
           			  window.location.reload(); 
           			}) 
	
           	});  
		})
		}
		 
		
		function refresh(){
			window.location.reload(); 
		}
       	//====================================日期========================================
        $.datetimepicker.setLocale('zh');
	     $('#mailDelTime').datetimepicker({
		       theme: '',              //theme: 'dark',
		       timepicker:false,       //timepicker:true,
		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
	     });
	     
	     
	   //====================================其他========================================
	
		function rest(){
			document.getElementById("showAllMail").innerHTML="";
		}
	   </script>
</html>