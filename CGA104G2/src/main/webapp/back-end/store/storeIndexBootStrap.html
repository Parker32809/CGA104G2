<!DOCTYPE html>
<!--繁體中文-->
<html lang="zh-Hant">

<head>
	<link rel="stylesheet" type="text/css" href="../../resources/datetimepicker/jquery.datetimepicker.css" />
	<link rel="shortcut icon" href="assets/images/logo/favicon.svg" type="image/x-icon">
	<link rel="shortcut icon" href="assets/images/logo/favicon.png" type="image/png">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.7/dist/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="../../resources/back-end/assets/css/main/app.css">
    <meta charset="UTF-8">
    <!-- 定義為RWD web -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 最佳兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <!-- 防止搜索引擎索引及檢索 -->
    <meta name="robots" content="noindex,nofollow">

    <!-- !!固定!! 後台樣板 css start -->
    <link rel="stylesheet" href="../../resources/back-end/assets/css/main/app.css">
    <!-- !!固定!! 後台樣板 css end -->

    <!-- favicon 網址列小圖示 -->
    <link rel="shortcut icon" href="../../resources/back-end/assets/images/main/favicons/favicon2.ico" type="image/x-icon">

<!--    需要用自己的css請放在這邊註解下方覆蓋 start -->
<style>
	.btn{
		margin-left: 10px;
	}
	.form-select {
		display: inline-block;
		width:11%;
	}
	.btn-primary{
		margin-left: 300px;
	}
	.swal2-container.swal2-center>.swal2-popup {
    	width: auto;
	}
	#img{ 
     	margin-left: 150%; 
     	width:150px;
     	height:100px;
     	border:0px;
 	} 
 	th{
 		white-space:nowrap;
 		text-align: center;
 	}
 	td{
 		text-align: center;
 	}
 	#thStoreInfo{
 		width: 300px;
 	}
 	#addMail{
 		margin-left:500px;
 	}
 	#backButton{
 		margin-left:500px;
 	}
</style>



<!--    自己的css end-->
<!--    網址列標題-->
    <title>陪你e生e世　社區服務平台</title>
    <!-- !!固定!! 旁邊導覽列sidebar menu start -->
    <script src="../../resources/back-end/assets/js/sidebar.js"></script>
    <!-- !!固定!! 旁邊導覽列sidebar menu end -->
</head>

<body onload="connect();">

<!-- !!Home頁面? 固定!!  右上方放小鈴鐺+登出+通知等等的 navbar -->
    <div id="main" class='layout-navbar'>
        <header class='mb-3'>
            <nav class="navbar navbar-expand navbar-light navbar-top">
                <div class="container-fluid">
                    <a href="#" class="burger-btn d-block">
                        <i class="bi bi-justify fs-3"></i>
                    </a>

                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav ms-auto mb-lg-0">
                        <li><a class="dropdown-item" href="#">
                            <i  class="bi-sub fs-4 bi bi-box-arrow-left"></i> Logout</a>
                        </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </header>
        <!-- !!固定!! 右上方 navbar end -->

    <!-- 頁面 START!　網頁請從這邊以下開始修改，不需要此格式想用自己的請刪除 ~　-->

            <div id="main-content">
                    <div class="page-heading">
                        <div class="page-title">
                            <div class="row">
                                <div class="col-12 col-md-6 order-md-1 order-last">
                                    <h3>特約商店管理</h3>
                                </div>
                                <div class="col-12 col-md-6 order-md-2 order-first">
                                    <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="../web/backEndHomeMgr.html">Home</a></li>
                                            <li class="breadcrumb-item active" aria-current="page">Store Management</li>
                                        </ol>
                                    </nav>
                                </div>
                            </div>
                        </div>
                        <section class="section">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title"></h4>
                                </div>
                                <div class="card-body">
                                
					                    <div>
					                        <select id="select_StoreTypeName" name="select_StoreTypeName" class="form-select">
					                            <option style="display: none;">請選擇</option>
					                        </select>
					                        <input type="text" id="search_StoreId" placeholder="輸入商店編號"> <input type="button" id="searchStore" value="搜尋">
											<button id="addMail" class="btn btn-primary">新增特約商店</button>
					                    </div>
					                    
					                </div>
					
					                <div id="showAllStore" class="showAllStore">
					                    <table id="getAllStroe" class="table table-hover">
					                        <tr>
					                            <th id='thStoreId'>商店編號</th>
					                            <th>商店名稱</th>
					                            <th>商店項目編號</th>
					                            <th id='thStoreInfo'>商店內容</th>
					                            <th>商店位置</th>
					                            <th>商店經度</th>
					                            <th>商店緯度</th>
					                            <th>圖片</th>
					                            <th>修改</th>
					                            <th>刪除</th>
					                        </tr>
					                        <tr id="allStroe">
					
					                        </tr>
					                    </table>
					                </div>
                                </div>
                            </div>
                        </section>
        </div>
<!--        頁面 END-->


<!--        !!固定!! footer(擺每個頁面最下方的版權用) START-->
            <footer>
                <div class="footer clearfix mb-0 text-muted">
                    <div class="float-start">
                        <p>2022 &copy; 陪你e生e世　社區服務平台</p>
                    </div>
                    <div class="float-end">
                        <p>Community Management</p>
                    </div>
                </div>
            </footer>
<!--        !!固定!! footer END-->
                </div>
            </div>

<!-- 樣板用js start -->
<script src="../../resources/back-end/assets/js/bootstrap.js"></script>
<script src="../../resources/back-end/assets/js/app.js"></script>
<!-- 樣板用js end -->

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
	<script src="../../resources/datetimepicker/jquery.js"></script>
	<script src="../../resources/datetimepicker/jquery.datetimepicker.full.js"></script>
	<script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
<!-- 	<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.0.0/sweetalert2.all.js"></script> -->
<!-- 	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script> -->
<!-- 	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script> -->
<!-- 	<script type="text/javascript"></script> -->

	<script>
	
	//=======================================================websocket================================================================	
	function back(){
		window.location.reload(); 
	}
		
	var MyPoint = "/TogetherWS/will";
	var host = window.location.host;
	var path = window.location.pathname;
	var webCtx = path.substring(0, path.indexOf('/', 1));
	var endPointURL = "ws://" + window.location.host + webCtx + MyPoint;
	let count;
	var webSocket;
    
    
    function connect() {
		// create a websocket
		webSocket = new WebSocket(endPointURL);
		let allReminder = JSON.parse(sessionStorage.getItem("Reminder"));
		let memberId = JSON.parse(sessionStorage.getItem("memberId"));
		
		webSocket.onopen = async function(event) {
			console.log("已連線");
			let id = memberId.id;
			
			
			if(!(allReminder === null)){
				let str = "<li id='mail' class='dropdown-item notification-item'>"
		            +"<a class='d-flex align-items-center' href='../../back-end/mail/mailIndexBootStrap.html'>"
		            +"<div class='notification-icon bg-success'>"
		            +"<i class='bi bi-file-earmark-check'></i>"
		            +"</div>"
		            +"<div class='notification-text ms-4'>"
		            +"<p class='notification-title font-bold'>" + allReminder.mailMessage + "</p>"	
		            +"</div></a></li>";
					
					$("#reminder").after(str);
			}
			
			await fetch("../../reminder/ReminderServlet?action=getAll&memberId="+ id, {
				method: 'get'
			})
			.then(res => res.json())	
			.then(res =>{
				showReminder(res);
			})
			
			
			function showReminder(res){
				 for (let i = 0; i < res.length; i++) {
					 let str = "<li id='mail' class='dropdown-item notification-item'>"
				            +"<a class='d-flex align-items-center' href='../../back-end/mail/mailIndexBootStrap.html'>"
				            +"<div class='notification-icon bg-success'>"
				            +"<i class='bi bi-file-earmark-check'></i>"
				            +"</div>"
				            +"<div class='notification-text ms-4'>"
				            +"<p class='notification-title font-bold'>" + res[i].reminderInfo + "</p>"	
				            +"</div></a></li>";
				            
						$("#reminder").after(str);
				 }
			}
			
			
			
		};

		webSocket.onmessage = function(event) {
			
			console.log("訊息");
			var reminder = document.getElementById("reminder");
			
			if(count === undefined){
				var jsonObj = JSON.parse(event.data);
				var message = jsonObj.message;
				let Reminder = {};
				Reminder.mailMessage = JSON.stringify(message);
				
				sessionStorage.setItem("Reminder", JSON.stringify(Reminder));
				let str = "<li  id='mail' class='dropdown-item notification-item'>"
		            +"<a class='d-flex align-items-center' href='../../back-end/mail/mailIndexBootStrap.html'>"
		            +"<div class='notification-icon bg-success'>"
		            +"<i class='bi bi-file-earmark-check'></i>"
		            +"</div>"
		            +"<div class='notification-text ms-4'>"
		            +"<p class='notification-title font-bold'>" + Reminder.mailMessage +"</p>"	
		            +"</div></a></li>";
				$("#reminder").after(str);
				count++;
			}
		};

// 		webSocket.onclose = function(event) {
// 			updateStatus("WebSocket Disconnected");
// 		};
	}
  //=======================================================顯示所有特約商店================================================================
        window.addEventListener("load",async function () {
			await fetch('../../back-end/store/store.do?action=getAll', {
				method: 'get'
			})
			.then(res => res.json())	
			.then(res =>{
				showStore(res);
			})
			
        });

        async function showStore(json) {
            let store = json;

            for (let i = 0; i < store.length; i++) {
                let str = null;
                str += "<tr><td>" + store[i].storeId + "</td>"
                	+"<td>" + store[i].storeName + "</td>"
                	+"<td>" + store[i].storeTypeName + "</td>"
                	+"<td>" + store[i].storeInfo + "</td>"
                	+"<td>" + store[i].storeLoc + "</td>"
                	+"<td>" + store[i].storeLon + "</td>"
                	+"<td>" + store[i].storeLat + "</td>"
                    + "<td id='prePhoto'><img width='150px' height='100px'src=data:image/jpeg;base64," + store[i].base64img + "></td>"
                    + "<td><input type='button' id='update' value='修改'></td>"
                    + "<td><input type='button' id='delete' value='刪除'></td></tr>";
                $("#allStroe").after(str);
//=======================================================修改按鈕================================================================
				document.getElementById('update').addEventListener('click', function(){
	            		
            		Swal.fire({
        	            title: "修改特約商店",
        	            html:"<form>"
        	                + "<table class='table table_sm'>"
        	                + "<tr><td>商店編號:</td><td><input type='TEXT' id='updateStoreId' size='45' value="+ store[i].storeId +" disabled='true'></td></tr>"
        	                + "<tr><td>商店名稱:</td><td><input type='text' id='updateStoreName' value=" + store[i].storeName + "></td></tr>"
        	                + "<tr><td>商店項目名稱:</td><td><input type='text' id='updateStoreTypeId' value=" + store[i].storeTypeId + "></td></tr>"
        	                + "<tr><td>商店位置:</td><td><input type='text' id='updateStoreLoc' value=" + store[i].storeLoc + "></td></tr>"
        	                + "<tr><td>商店經度:</td><td><input type='text' id='updateStoreLon' value=" + store[i].storeLon + "></td></tr>"
        	                + "<tr><td>商店緯度:</td><td><input type='text' id='updateStoreLat' value=" + store[i].storeLat + "></td></tr>"
        	                + "<tr><td>商店圖片:</td><td><input id='updateStorePhoto' type='file' width='150px' height='100px'></td></tr>"
        	                + "<tr><td><img id=img width='150px' height='100px'src=data:image/jpeg;base64," + store[i].base64img + "></td></tr>"
        	                + "<tr><td>商店內容:</td><td><textarea id='updateStoreInfo' rows='10px' cols='30px'>" + store[i].storeInfo + "</textarea></td></tr>"
        	                + "</form>",
        	            confirmButtonColor:'#3085d6',
        	        	confirmButtonText:'確定',
        	        	showCancelButton:true,
        	        	cancelButtonText:'取消',
        	        	cancelButtonColor:'#d33',
        	        	
        	        	didOpen: () => {
        	        		$('#updateStorePhoto').on('change', function(e){      
        	        			  const file = this.files[0];
        	        			  const fr = new FileReader();
        	        			  fr.onload = function (e) {
        	        			    $('#img').attr('src', e.target.result);
        	        			  };
        	        			      
        	        			  fr.readAsDataURL(file);
        	        			});
        	        	},
        	        	preConfirm: function(){
        	        		
        	        		let updateStoreId = document.getElementById('updateStoreId').value,
        	        			updateStoreName = document.getElementById('updateStoreName').value,
        	        			updateStoreTypeId = document.getElementById('updateStoreTypeId').value,
        	        			updateStoreLoc = document.getElementById('updateStoreLoc').value,
        	        			updateStoreLon = document.getElementById('updateStoreLon').value,
        	        			updateStoreLat = document.getElementById('updateStoreLat').value,
        	        			updateStorePhoto = document.getElementById('updateStorePhoto').files[0],
        	        			updateStorePhoto2 = document.getElementById('updateStorePhoto'),
        	        			updateStoreInfo = document.getElementById('updateStoreInfo').value;
        	        			
            	        	
           	        		if (updateStoreName === "") {
           	                	Swal.showValidationMessage('商店名稱請勿空白');
           	        		}else if(updateStoreTypeId ===""){
           	        			Swal.showValidationMessage('商店編號請勿空白');
           	        		}else if(updateStoreLoc ===""){
           	        			Swal.showValidationMessage('商店地址請勿空白');
           	        		}else if(updateStoreLon ===""){
           	        			Swal.showValidationMessage('商店經度請勿空白');
           	        		}else if(updateStorePhoto === undefined){
           	        			Swal.showValidationMessage('商店圖片請勿空白');
           	        		}else if(updateStoreLat ===""){
           	        			Swal.showValidationMessage('商店緯度請勿空白');
           	        		}else if(updateStorePhoto ===""){
           	        			Swal.showValidationMessage('商店圖片期請勿空白');
           	        		}else if(updateStoreInfo ===""){
           	        			Swal.showValidationMessage('商店介紹請勿空白');
           	        		}else{
           	        		
           	        			const photoFile = updateStorePhoto2.files[0];
           	        			const fileReader = new FileReader();
            	        		
	           	        		fileReader.addEventListener('load', async e => {
	           	                    const base64Str = btoa(e.target.result);
	           	                   
	           	                    await fetch('../../back-end/store/store.do?action=update', {
	           	    					method: 'post',
	           	    					headers: {
	           	    						'Content-Type': 'application/json'
	           	    					},
	           	    					body: JSON.stringify({
	           	    							storeId:updateStoreId,
	           	    							storeName:updateStoreName,
	          	    							storeTypeId: updateStoreTypeId,
	          	   	        					storeLoc: updateStoreLoc,
	          	   	        					storeLon: updateStoreLon,
	          	   	        					storeLat: updateStoreLat,
	          	   	        					storePhoto: base64Str,
	          	   	        					storeInfo: updateStoreInfo	
	           	    					})
	           	    				})
	           	                })
	           	               fileReader.readAsBinaryString(photoFile);
	        	        	   refresh();
        	        		}
    	        		}
        	     	})
            		
            		$.datetimepicker.setLocale('zh');
   	            	$('#updateMailDelTime').datetimepicker({
   		       		       theme: '',              //theme: 'dark',
   		       		       timepicker:false,       //timepicker:true,
   		       		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
   		       		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
   	       	     	});	
				});
//=======================================================刪除按鈕================================================================
                let actionDelete = document.getElementById("delete");
            	actionDelete.addEventListener("click", function(){
            		
            		const swalWithBootstrapButtons = Swal.mixin({
            			  customClass: {
            			    confirmButton: 'btn btn-success',
            			    cancelButton: 'btn btn-danger'
            			  },
            			  buttonsStyling: false
            			})

            			swalWithBootstrapButtons.fire({
            			  title: '確定要刪除嗎?',
            			  icon: 'warning',
            			  confirmButtonText: '確定',
            			  cancelButtonText: '取消',
            			  showCancelButton: true
            			  
            			}).then((result) => {
            			  if (result.isConfirmed) {
            			    fetch('../../back-end/store/store.do?action=delete&storeId='+ store[i].storeId, {method: 'get',});
            			  }
            			  	refresh();
            			}) 
       			 })
            }
        }
//=======================================================新增特約商店================================================================
        window.addEventListener("load", function () {
	        document.getElementById("addMail").onclick = function(){
	        	Swal.fire({
    	            title: "新增特約商店",
    	            html:"<form>"
    	                + "<table class='table table_sm'>"
    	                + "<tr><td>商店名稱:</td><td><input type='text' id='addStoreName' value='餐廳'></td></tr>"
    	                + "<tr><td>商店項目編號:</td><td><input type='text' id='addStoreTypeId' value='1'></td></tr>"
    	                + "<tr><td>商店位置:</td><td><input type='text' id='addStoreLoc' value='桃園市中壢區'></td></tr>"
    	                + "<tr><td>商店經度:</td><td><input type='text' id='addStoreLon' value='121.225236'></td></tr>"
    	                + "<tr><td>商店緯度:</td><td><input type='text' id='addStoreLat' value='24.956886'></td></tr>"
    	                + "<tr><td>商店圖片:</td><td><input id='addStorePhoto' type='file' width='150px' height='100px'></td></tr>"
    	                + "<tr><td><img id='img'></td></tr>"
    	                + "<tr><td>商店內容:</td><td><textarea id='addStoreInfo' rows='10px' cols='30px'>餐廳餐廳餐廳餐廳餐廳餐廳餐廳餐廳餐廳餐廳</textarea></td></tr>"
    	                + "</form>",
    	            confirmButtonColor:'#3085d6',
    	        	confirmButtonText:'確定',
    	        	showCancelButton:true,
    	        	cancelButtonText:'取消',
    	        	cancelButtonColor:'#d33',
    	        	showLoaderOnConfirm: true,
    	        	didOpen: () => {
    	        		$('#addStorePhoto').on('change', function(e){      
    	        			  const file = this.files[0];
    	        			  const fr = new FileReader();
    	        			  fr.onload = function (e) {
    	        			    $('#img').attr('src', e.target.result);
    	        			  };
    	        			      
    	        			  fr.readAsDataURL(file);
    	        			});
    	        	},
    	        	preConfirm: async function(){
    	        		
    	        		let addStoreName = document.getElementById('addStoreName').value,
    	        			addStoreTypeId = document.getElementById('addStoreTypeId').value,
	    	        		addStoreLoc = document.getElementById('addStoreLoc').value,
	    	        		addStoreLon = document.getElementById('addStoreLon').value,
	    	        		addStoreLat = document.getElementById('addStoreLat').value,
	    	        		addStorePhoto = document.getElementById('addStorePhoto').files[0],
	    	        		addStorePhoto2 = document.getElementById('addStorePhoto'),
	    	        		addStoreInfo = document.getElementById('addStoreInfo').value;
    	        		
    	        		console.log(addStorePhoto);
    	        		if (addStoreName === "") {
       	                	Swal.showValidationMessage('商店名稱請勿空白');
       	        		}else if(addStoreTypeId ===""){
       	        			Swal.showValidationMessage('商店編號請勿空白');
       	        		}else if(addStoreLoc ===""){
       	        			Swal.showValidationMessage('商店地址請勿空白');
       	        		}else if(addStoreLon ===""){
       	        			Swal.showValidationMessage('商店經度請勿空白');
       	        		}else if(addStoreLat ===""){
       	        			Swal.showValidationMessage('商店緯度請勿空白');
       	        		}else if(addStorePhoto === undefined){
       	        			Swal.showValidationMessage('商店圖片期請勿空白');
       	        		}else if(addStoreInfo ===""){
       	        			Swal.showValidationMessage('商店介紹請勿空白');
       	        		}else{
       	        		
    	        		
    	        		const photoFile = addStorePhoto2.files[0];
    	        		const fileReader = new FileReader();
    	        		
    	        		fileReader.addEventListener('load', e => {
       	                    const base64Str = btoa(e.target.result);
       	                   
       	                    fetch('../../back-end/store/store.do?action=insert', {
       	    					method: 'post',
       	    					headers: {
       	    						'Content-Type': 'application/json'
       	    					},
       	    					body: JSON.stringify({
       	    							storeName:addStoreName,
      	    							storeTypeId: addStoreTypeId,
      	   	        					storeLoc: addStoreLoc,
      	   	        					storeLon: addStoreLon,
      	   	        					storeLat: addStoreLat,
      	   	        					storePhoto: base64Str,
      	   	        					storeInfo: addStoreInfo		
       	    					})
       	    				})
       	                })
        	           fileReader.readAsBinaryString(photoFile);
    	        	   refresh();
       	        		}
    	        	}
    	        })
	        	
        		$.datetimepicker.setLocale('zh');
	            	$('#addMailDelTime').datetimepicker({
		       		       theme: '',              //theme: 'dark',
		       		       timepicker:false,       //timepicker:true,
		       		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
		       		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
	       	     	});
	            	
	        };
	        
	    }, false);
		
        
//=======================================================搜尋================================================================	
		async function get() {
		    let res = await fetch("../../back-end/store/store.do?action=selectStoreType", { method: 'get' })
		    data = await res.json()
			data.forEach(type => {
				$("#select_StoreTypeName").append(`<option value=${type.storeTypeName}>${type.storeTypeName}</option>`);	
			})
		}
		get();
		
    	document.getElementById("searchStore").onclick = async function searchMail(){
			rest();
			let select_StoreTypeName = $("#select_StoreTypeName").val();
			let search_StoreId = $("#search_StoreId").val();
			if(search_StoreId === ""){
				search_StoreId = 0;
			}
			
			let res = await fetch(`../../back-end/store/store.do?action=search&storeTypeName=${select_StoreTypeName}&storeId=${search_StoreId}`, { method: 'get' });
			let data = await res.json();
			console.log(data);
			$("#showAllStore").append(
					`
					<table id="getAllStore" class='table table_sm'>
					<tr>
					<th>商店編號</th>
                    <th>商店名稱</th>
                    <th>商店項目</th>
                    <th id='thStoreInfo'>商店內容</th>
                    <th>商店位置</th>
                    <th>商店經度</th>
                    <th>商店緯度</th>
                    <th>圖片</th>
                    <th>修改</th>
                    <th>刪除</th>
					</tr>
					<tr id="allStroe">
					</tr>
					</table>
					<div><input type='button' id='backButton' onclick='back()' value='回首頁'></div>`),
			
					 
					 
					 
			data.forEach(store => {
				$("#allStroe").after(
					`<tr><td> ${store.storeId} </td>
					<td> ${store.storeName} </td>
			    	<td> ${store.storeTypeName} </td>
			    	<td> ${store.storeInfo} </td>
			    	<td> ${store.storeLoc} </td>
			    	<td> ${store.storeLon} </td>
			    	<td> ${store.storeLat} </td>
			    	<td><img width='150px' height='100px'src='data:image/jpeg;base64,${store.base64img}'</td>
					<td><button id='update'>修改</button></td>
			    	<td><input type='button' id='delete' value='刪除'></td></tr>`)
			   
		 //=====================================修改=============================================  		
	         
	         
           document.getElementById('update').addEventListener('click', function(){
          		Swal.fire({
      	            title: "修改郵件",
      	            html:"<table class='table table_sm'>"
      	           	+ "<tr><td>郵件編號:</td>"
      	            +"<td><input type='TEXT' id='updateMailId' size='45' value='"+ mail.mailId +"' disabled='true'></td></tr>"
      	            +"<tr><td>住戶編號:</td>"
      	            +"<td><input type='TEXT' id='updateMemberId' size='45' value='"+ mail.memberId +"'></td></tr>"
      	        	+"<tr><td>郵件項目:</td>"
				    +"<td><label for='pack'>"
			        +"<input type='radio' id='pack' name='updateMailType' value='包裹'>包裹</label>"
			        +"<label for='registered'>"
			        +"<input type='radio' id='registered' name='updateMailType' value='掛號'>掛號"
			        +"</label></td></tr>"
      	            +"<tr><td>郵件到達時間:</td>"
      	            +"<td><input type='TEXT' id='updateMailDelTime' value='"+ mail.mailDelTime +"'></td></tr>"
      	            +"<tr><td>郵件取貨日期:</td>"
      	            +"<td><input type='TEXT' id='updateMailPickupTime' value='"+ ((mail.mailPickupTime === undefined) ? "": mail.mailPickupTime) +"'></td></tr>"
     	        	+"<tr><td>郵件狀態:</td>"
		            +"<td><label for='unaccalimed'>"
		            +"<input type='radio' id='unaccalimed' name='updateMailState' value='0' checked>未領取"
		            +"</label><label for='received'>"
		            +"<input type='radio' id='received' name='updateMailState' value='1'>已領取"
		            +"</label><label for='returning'>"
		            +"<input type='radio' id='returning' name='updateMailState' value='2'>退貨中"
		            +"</label>"
		            +"<label for='returnComplete'>"
		            +"<input type='radio' id='returnComplete' name='updateMailState' value='3'>退貨完成"
		            +"</label>"
		            +" </td></table>",
      	            confirmButtonColor:'#3085d6',
      	        	confirmButtonText:'確定',
      	        	showCancelButton:true,
      	        	cancelButtonText:'取消',
      	        	cancelButtonColor:'#d33',
      	        	
      	        	preConfirm: function(){
      	        		let updateMailId = document.getElementById('updateMailId').value,
      	        			updateMemberId = document.getElementById('updateMemberId').value,
      	        			updateMailType = $("input[name='updateMailType']:checked").val(),
      	        			updateMailDelTime = document.getElementById('updateMailDelTime').value,
      	        			updateMailPickupTime = document.getElementById('updateMailPickupTime').value,
      	        			updateMailState = $("input[name='updateMailState']:checked").val();
      	        		
      	        		
      	        		if(updateMemberId ===""){
       	        			Swal.showValidationMessage('商店編號請勿空白');
       	        		}else if(updateMailType ===""){
       	        			Swal.showValidationMessage('商店地址請勿空白');
       	        		}else if(updateMailDelTime ===""){
       	        			Swal.showValidationMessage('商店經度請勿空白');
       	        		}else if(updateMailState ===""){
       	        			Swal.showValidationMessage('商店緯度請勿空白');
       	        		}else{
  	        			
       	        			const photoFile = addStorePhoto2.files[0];
          	        		const fileReader = new FileReader();
          	        		fileReader.addEventListener('load', e => {
        	                    const base64Str = btoa(e.target.result);
        	                    fetch('../../back-end/store/store.do?action=update', {
          	    					method: 'post',
          	    					headers: {
          	    						'Content-Type': 'application/json'
          	    					},
          	    					body: JSON.stringify({
          	    						mailId: updateMailId,
          	          	    			memberId: updateMemberId,
          	          	    			mailType: updateMailType,
          	          	    			mailDelTime: updateMailDelTime,
          	          	    			mailPickupTime: updateMailPickupTime,
          	          	    			mailState: updateMailState
          	    					})
          	        			})
	    					})
	    				 fileReader.readAsBinaryString(photoFile);
          	        	 refresh();
      	        		}
      	        	}
      	       
      	        })

          		$.datetimepicker.setLocale('zh');
 	            	$('#updateMailDelTime').datetimepicker({
 		       		       theme: '',              //theme: 'dark',
 		       		       timepicker:false,       //timepicker:true,
 		       		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
 		       		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
 	       	     	});
	            	
 	            	$('#updateMailPickupTime').datetimepicker({
 		       		       theme: '',              //theme: 'dark',
 		       		       timepicker:false,       //timepicker:true,
 		       		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
 		       		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
 	       	     	});	
     	        });
           
          	//=====================================刪除=============================================
          	
          	let actionDelete = document.getElementById("delete");
          	actionDelete.addEventListener("click", function(){
          		
          		const swalWithBootstrapButtons = Swal.mixin({
          			  customClass: {
          			    confirmButton: 'btn btn-success',
          			    cancelButton: 'btn btn-danger'
          			  },
          			  buttonsStyling: false
          			})

          			swalWithBootstrapButtons.fire({
          			  title: '確定要刪除嗎?',
          			  icon: 'warning',
          			  confirmButtonText: '確定',
          			  cancelButtonText: '取消',
          			  showCancelButton: true
          			}).then((result) => {
          			  if (result.isConfirmed) {
          			    fetch('../../back-end/mail/mail.do?action=delete&mailId='+ mail[i].mailId, {method: 'get',});
          			  }
          			  window.location.reload(); 
          			}) 
          	});  
		})
		}
        
        
      //====================================其他========================================
    	function refresh(){
			window.location.reload(); 
		}
      
		function rest(){
			document.getElementById("showAllStore").innerHTML="";
		}
	   </script>
</html>