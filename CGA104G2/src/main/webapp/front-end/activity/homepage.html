<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="http://code.jquery.com/jquery-3.6.0.min.js"></script>
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="../../resources/css/homestyle.css">
<Style>
</Style>
</head>
<body>



	<div style="float: left; width: 20%">
		查詢活動
		<form id="form">
			<p class="selectstyle selectstyle--style2">
				<span class="selectstyle__box"> <span>地區</span> <select
					id="country" name ="country" class="selectstyle__box__select">
				</select>
				</span>
			</p>
			<p class="selectstyle selectstyle--style2">
				<span class="selectstyle__box"> <span>活動種類</span> <select
					id="type" name="type" class="selectstyle__box__select">
					<option>請選擇</option>
				</select>
				</span>
			</p>
			<input id="name"  type="email" placeholder="活動名稱">
			 <input type="button" name="submit" value="查詢" onclick="getData()" />
		</form>
		
		<a href="mylist.html">我舉辦的活動</a>
		<a href="addactivity.html">新增活動</a>
	</div>
	
	
	

	<div class="container" style="float: left; width: 70%">
		<div class="row">
			<div class="col-md-12">
				<div class="table-wrap">
					<table class="table">
						<thead class="thead-primary">
							<tr >
								<th>活動資訊</th>
								<th>&nbsp;</th>
								<th>目前人數</th>
								<th>活動地點</th>	
								<th>活動詳情</th>
							</tr>
						</thead>
						<tbody id="addPage">
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	<div id="button" class="frame1"></div>
	<script>    

	

	
	
	
	getButton()
	async function getButton(){
		restButton()
		let res = await fetch("../../activity/ActServlet?action=getButton", { method: 'get' })
		let data = await res.json();
		let number = data.button
		for(let i=0;i<number;i++){
			$("#button").append(`<button type="submit" class="custom-btn btn-4" onclick="showInfo(${i})">第${i+1}頁</button>`)
		}
	
		showInfo(0)
		getCountry();
		getType();
	}
	
	
	async function showInfo(page){
		rest()
		let res = await fetch("../../activity/ActServlet?action=getPage&page="+page, { method: 'get' })
		let data = await res.json();
		
		data.forEach(act => {
				$("#addPage").append(`<tr class="alert" role="alert"><td><img src="data:image/jpeg;base64,${act.photo}"></td>
								<td>
									<div class="email">
									<span>活動名稱:${act.activityName}</span><span>報名開始時間:${act.activitySignst}</span> <span>活動開始時間:${act.activityStart}
										</span><span>活動結束時間:${act.activityEnd}</span>
									</div>
								</td>
								<td><span>${act.activityCurrent}/${act.activityMax}</span></td>
								<td>${act.actLocation}</td><span></span><span></span><td><a href="../../activity/ActServlet?action=view&actId=${act.activityId}">活動詳情</a></td><tr>`)	
		} )
	}
	
	
	
	

	async function getCountry() {  
			html=""
			document.getElementById("country").innerHTML=" "
        let res = await fetch("../../activity/ActServlet?action=location", { method: 'get' });
      	data = await res.json();	
      	$("#country").append(`<option value="">請選擇</option>`)	
		data.forEach(location => {
			$("#country").append(`<option  value=${location.actCountry}>${location.actCountry}</option>`)	
			})
	}
	
	

	async function getType(){
			html=""
			document.getElementById("type").innerHTML=" "
		  let res = await fetch("../../activity/ActivityTypeServlet?action=getType", { method: 'get' });
	      	data = await res.json();	
	      	$("#type").append(`<option value=0>請選擇</option>`)	
			data.forEach(location => {
				$("#type").append(`<option  value=${location.actTypeId}>${location.actTypeName}</option>`)	
				})		
	}
	
	
	
	
	
	async function getData(){
		rest()
		restButton()
		const country = $("#country").val();
		const type= $("#type").val();
		const name= $("#name").val();
		let res = await fetch(`../../activity/ActServlet?action=search&country=${country}&type=${type}&name=${name}`, { method: 'post' })
		let data = await res.json();
		data.forEach(act => {
			$("#addPage").append(`<tr class="alert" role="alert"><td><img src="data:image/jpeg;base64,${act.photo}"></td>
							<td>
								<div class="email">
								<span>活動名稱:${act.activityName}</span><span>報名開始時間:${act.activitySignst}</span> <span>活動開始時間:${act.activityStart}
									</span><span>活動結束時間:${act.activityEnd}</span>
								</div>
							</td>
							<td>${act.activityCurrent}/${act.activityMax}</td>
							<td>${act.actLocation}</td><span></span><span></span><td><a href="../../activity/ActServlet?action=view&actId=${act.activityId}">活動詳情</a></td><tr>`)	
	} )

	
 	$("#button").append(`<button type="submit" class="custom-btn btn-4" onclick="getButton(0)">返回總查詢</button>`)
	
	}		

	
	

	
	
	
	

	function rest(){
		html=""
		document.getElementById("addPage").innerHTML=" "
		
	}
	
	
	function restButton(){
		html=""
		document.getElementById("button").innerHTML=" "
		
	}
	
	
	

	
	
	

// 	async function add(e){
// 			try{
// 			let actid = e
// 			let res =  await fetch("../../activity/ActServlet?action=adddata&actid="+e , { method: 'get' });
// 			let data = await res.json();	
// 			let res2 =  await fetch("../../activity/ActPhotoServlet?action=actPhoto&actId="+e , { method: 'get' });
// 			let photo = await res2.json();
// 			html = "<table class=table table-striped>";
// 			html += `
			
// 		<tr>	
// 		 <td> <div id="bob-2item"></div></td>	
// 		</tr>		
// 	    <tr>
// 	      <th scope="row">活動名稱</th>
// 	      <td>${data.activityName}</td>
// 	    </tr>
// 	    <tr>
// 	      <th scope="row">活動內容</th>
// 	      <td>${data.activityContent}</td>
// 	    </tr>
// 	    <tr>
// 	      <th scope="row">活動縣市</th>
// 	      <td>${data.actCountry}</td>
// 	    </tr>
// 	    <tr>
// 	      <th scope="row">活動地址</th>
// 	      <td>${data.actLocation}</td>
// 	    </tr>
// 	    <tr>
// 	      <th scope="row">活動開始時間</th>
// 	      <td>${data.activityStart}</td>
// 	    </tr>
// 	    <tr>
// 	      <th scope="row">活動結束時間</th>
// 	      <td>${data.activityEnd}</td>
// 	    </tr>
// 		<tr>
// 	      <th scope="row">報名開始時間</th>
// 	      <td>${data.activitySgst}</td>
// 	    </tr>
// 	    <tr>
// 	      <th scope="row">報名結束時間</th>
// 	      <td>${data.activitySget}</td>
// 	    </tr>
// 		<tr>
// 	      <th scope="row">目前人數</th>
// 	      <td>${data.activityCur}</td>
// 	    </tr>
// 		<tr>
// 	      <th scope="row">活動最多人數</th>
// 	      <td>${data.activityMax}</td>
// 	    </tr>
// 		<tr>
// 	      <th scope="row">活動最小人數</th>
// 	      <td>${data.activityMin}</td>
// 	    </tr>
// 		<tr>
// 	      <th scope="row">活動費用</th>
// 	      <td>${data.activityCost}</td>
// 	    </tr>
// 		<tr>
// 		<td>
// 	    <input type=button  onclick="addperson(${data.activityId})"  value=我要參加></input>
// 	   </td>
// 	   <td>
// 	   <form>
// 	    <input type=button  onclick="reportAct(${data.activityId})"  value=我要檢舉></input>
// 	   </td>
// 	    </tr>
// 	    `					
		
// 	    	html += "</table>";	
// 	    	let p = document.getElementById("showPanel").innerHTML = html;
// 	    photo.forEach(actPhoto =>{
// 				$("#bob-2item").append( `<img src="data:image/jpeg;base64,${actPhoto.photo}">`)				
// 			})		
	    		
// 			}catch{
			
				
// 				}
				
// 			}
	


// 	function reportAct(actId){
// 		console.log(actId)
// 		sessionStorage.setItem('actId',actId);
// 		location ="reportactivity.jsp";
// 	}
	
	web()
	function web(){
	   let path = window.location.pathname;
    console.log(path)
             let webCtx = path.substring(0, path.indexOf('/', 1));
        console.log(webCtx)
	}
	

</script>

</body>
</html>