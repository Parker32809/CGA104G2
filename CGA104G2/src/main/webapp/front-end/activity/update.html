<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>更新活動</title>


<meta charset="utf-8">
    <title>社區業務管理系統-陪你e生e世</title>
    <meta name="robots" content="noindex,nofollow">
<!--    禁止本地端快取-->
<!--    <Meta http-equiv="Pragma" Content="No-cache">-->
<!--    隱藏圖片下載-->
    <meta http-equiv="imagetoolbar" content="false">
    <meta name="keywords" content="">
    <!-- 定義為RWD web -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!-- 最佳兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <!--=============Google Font ===============-->
    <link href="https://fonts.googleapis.com/css?family=Lato:300&display=swap" rel="stylesheet">
    <!-- !!固定!! favicon 網址列屬於網站的小圖示 -->
    <link rel="shortcut icon" href="../../resources/back-end/assets/images/main/favicons/favicon2.ico" type="image/x-icon">

    <!--==============css===============-->
    <!--font awesome kit-->
    <script src="https://kit.fontawesome.com/7e021e96db.js" crossorigin="anonymous"></script>
    <!--!!固定!! 前台樣式-->
    <link rel="stylesheet" type="text/css" href="../../resources/front-end/assets/css/jquery.bxslider.min.css">
    <link rel="stylesheet" type="text/css" href="../../resources/front-end/assets/css/reset.css">
    <link rel="stylesheet" type="text/css" href="../../resources/front-end/assets/css/layout.css">
    <link rel="stylesheet" type="text/css" href="../../resources/front-end/assets/css/parts.css">
    <!--modaal-->
    <link rel="stylesheet" type="text/css" href="../../resources/front-end/assets/css/modaal.min.css">

    <!--=============js=============-->
    <!--延遲載入-->
    <script src="../../resources/front-end/assets/js/lazyload.min.js"></script>
    <!--vue-->
<script src="https://cdn.jsdelivr.net/npm/vue@2.7.13"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!--axios-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js"></script> 
    <!--vue表單-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/vee-validate/4.5.8/vee-validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@vee-validate/rules@4.5.8/dist/vee-validate-rules.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@vee-validate/i18n@4.5.8/dist/vee-validate-i18n.min.js"></script>
    <!--datepicker-->
<script src="https://unpkg.com/@vuepic/vue-datepicker@latest"></script>
<link rel="stylesheet" href="https://unpkg.com/@vuepic/vue-datepicker@latest/dist/main.css">
    <!--date mount-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <!--sweetalert2-->
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<!--==============這邊放自己的 css===============-->
	  <link rel="stylesheet" href="../../resources/css/update2.css">


<body>

               <header id="header">

<!--!!固定!! 導覽列 start-->
            <nav id="pc-nav">
                <!--!!固定!! logo-->
                <div>
                    <h1 style="width:166px" ><a href="../../front-end/web/front-index2.html"><img src="../../resources/front-end/assets/img/logo11_trans4.png" alt="陪你e生e世　社區服務平台" style="width: 100%; display: flex;justify-content: flex-start; flex-direction: inherit;"></a></h1>
                </div>
            </nav>
            <span style="margin-left:10px"></span>
                <ul>
                    <div>
                        <a href="homepage3.html"><button class="cap" id="mylist" data-tippy-content="<div class='inner-cap'><p>回到活動首頁</p><p>社區住戶專用。</p></div>"><i style="font-size: 1rem;" class="fa-solid fa-house"></i><label style="font-size: 1rem;">活動首頁</label></button></a>
                    </div>
                </ul>
                <ul>
                    <div>
                        <a href="mylist.html"><button class="cap" id="mylist" data-tippy-content="<div class='inner-cap'><p>我舉辦的活動</p><p>社區住戶專用。</p></div>"><i style="font-size: 1rem;" class="fa-solid fa-table-list"></i><label style="font-size: 1rem;">我舉辦的活動</label></button></a>
                    </div>
                </ul>
                  <ul>
                    <div  >
                        <a href="myaddlist.html"><button class="cap"  id="login" data-tippy-content="<div class='inner-cap'><p>我參加的活動</p><p>社區住戶專用。</p></div>"><i style="font-size: 1rem;" class="fa-solid fa-user-plus"></i><label style="font-size: 1rem;"> 我參加的活動</label></button></a>
                    </div>
                </ul>
                    <ul>
                    <div >
                        <a href="addactivity.html"><button class="cap"  id="add" data-tippy-content="<div class='inner-cap'><p>新增活動。</p><p>社區住戶專用。</p></div>"><i style="font-size: 1rem;" class="fa-solid fa-plus"></i><label style="font-size: 1rem;"> 新增活動</label></button></a>
                    </div>
                </ul>
                
                    <ul>
                    <div id="login-div" >
                        <a href="#"><button class="cap"  id="login" data-tippy-content="<div class='inner-cap'><p>住戶登入/登出。</p><p>社區住戶專用。</p></div>"><i style="font-size: 1rem;" class="fa-solid fa-right-to-bracket"></i><label style="font-size: 1rem;"> 登出</label></button></a>
                    </div>
                </ul>
            <ul>
                <div id="out-div" >
                    <a href="#"><button class="cap"  id="out" data-tippy-content="<div class='inner-cap'><p>住戶訊息通知。</p><p>檢視您的個人訊息。</p></div>"><i style="font-size: 1rem;" class="fa-solid fa-bell"></i><label style="font-size: 1rem;"> 通知</label></button></a>
                </div>
            </ul>
            <!--導覽列 end-->
        </header>


<!--!!固定!! 空白遮罩-->
        <div style="width: 100%; height:100px;"></div>

<!--!!固定!! main area-->
        <div id="container">



<main id="main-area">


<div id="app">
    <v-form METHOD="post"  id="myForm" 
    v-slot="{ errors,onSubmit}"  @submit="onSubmit(submitForm)"
	name="form1" enctype="multipart/form-data">
       

        <fieldset>
    
            <legend>
                <span class="number">1</span>新增圖片
            </legend>
    
            <label for="photo"></label> 
            <input type="file" name="photo1"  @change="upload($event.target.files)" style="border-radius:0px"
                multiple="multiple"  />
    
        </fieldset>
        <fieldset>
            <legend>
                <span class="number">2</span>修改資料
            </legend>
    		
    		
            <label for="name">活動名稱</label> 
            <v-field  type="text"  name="活動名稱" :rules="checkName"   v-model="activity.actName"></v-field>
            <error-message name="活動名稱" class="invalid-feedback"></error-message>

            <label>活動內容:</label>
            <v-field type="text" id="actContent" :rules="checkContent" name="actContent"  v-model="activity.actContent"></v-field> 
            <error-message name="actContent" class="invalid-feedback"></error-message>
            
            <label>活動類別:</label>
            <v-field   v-model="activity.actType" id="actTypeNo" name="actTypeNo" as="select">
                <option v-for="t in type" :value="t.actTypeId" >{{t.actTypeName}}</option>
            </v-field>
        
            
            <label>活動最大人數:</label> 
            <v-field  type="TEXT" id="actMax"  :rules="checkMax" name="活動最大人數" v-model="activity.actMaxCount"></v-field> 
            <error-message name="活動最大人數" class="invalid-feedback"></error-message>

            <label>活動最小人數:</label> 
            <v-field  type="TEXT" id="actMin" name="活動最小人數" :rules="checkMin" v-model="activity.actMinCount"></v-field>
            <error-message name="活動最小人數" class="invalid-feedback"></error-message>

            
            <label>活動報名開始時間</label>
            <Datepicker v-model="activity.signStart"  placeholder="請選擇時間" format="yyyy/MM/dd"  ></Datepicker>
            <v-field  v-show="false" type="date" :rules="checkDay" name="活動報名開始時間"  v-model="activity.signStart"></v-field> 
            <error-message name="活動報名開始時間" class="invalid-feedback"></error-message>
            

            <label>活動報名結束時間</label>
            <Datepicker v-model="activity.signEnd"   name="actSignEnd" format="yyyy/MM/dd"  ></Datepicker>
            <v-field  v-show="false" type="date"  :rules="checkSingEnd" name="actSignEnd"  v-model="activity.signEnd"></v-field> 
            <error-message name="actSignEnd" class="invalid-feedback"></error-message>

            <label>活動開始時間</label>
            <Datepicker v-model="activity.actStart"  name="actSignEnd" format="yyyy/MM/dd"></Datepicker>
            <v-field  v-show="false" type="date"  :rules="checkActStart" name="actStart"  v-model="activity.actStart"></v-field> 
            <error-message name="actStart" class="invalid-feedback"></error-message>

            <label>活動結束時間</label>
            <Datepicker v-model="activity.actEnd"  name="actSignEnd" format="yyyy/MM/dd" ></Datepicker>
            <v-field  v-show="false" type="date"  :rules="checkEnd" name="actEnd"  v-model="activity.actEnd"></v-field> 
            <error-message name="actEnd" class="invalid-feedback"></error-message>

            <label >活動縣市</label>
            <v-field  v-model="activity.actCountry" name="actCountry" as="select">
                <option value='基隆市'>基隆市</option>
                <option value='台北市'>台北市</option>
                <option value='新北市'>新北市</option>
                <option value='宜蘭縣'>宜蘭縣</option>
                <option value='桃園市'>桃園市</option>
                <option value='新竹市'>新竹市</option>
                <option value='新竹縣'>新竹縣</option>
                <option value='苗栗縣'>苗栗縣</option>
                <option value='台中市'>台中市</option>
                <option value='南投縣'>南投縣</option>
                <option value='彰化縣'>彰化縣</option>
                <option value='雲林縣'>雲林縣</option>
                <option value='嘉義縣'>嘉義縣</option>
                <option value='台南市'>台南市</option>
                <option value='高雄市'>高雄市</option>
                <option value='屏東縣'>屏東縣</option>
                <option value='花蓮縣'>花蓮縣</option>
                <option value='臺東縣'>臺東縣</option>
                <option value='澎湖縣'>澎湖縣</option>
                <option value='金門縣'>金門縣</option>
                <option value='連江縣'>連江縣</option>
            </v-field> 
            <label>活動地址:</label> 
            <v-field type="text" name="actLocation"  :rules="checkName" v-model="activity.actLocation"></v-field>
            <error-message name="actLocation" class="invalid-feedback"></error-message>

            <label>活動費用:</label> 
            <v-field type="text" name="活動費用" rules="required|min_value:1" v-model="activity.actCost"></v-field>
            <error-message name="活動費用" class="invalid-feedback"></error-message>
		
			<label>原有照片修改:</label>
			<span v-for="photo in photos">
                <img class="img1" :src="`data:image/png;base64,${photo.photo}`">
                <input class="button1" type="button" @click="deletePhoto(photo.actPhotoId)" class="deletePhoto" value="刪除">
            </span>
			 


        </fieldset>
        <button  class="button1" type="submit" @click="onSubmit">送出修改</button>      
        
 		
          
    </v-form>
       
      


</div>
</main>
 </div>

<!--!!固定!! footer-->
        <footer id="footer">
<!--右上角menu-->
            <div class="openbtn"><span></span><span>Menu</span><span></span></div>
            <div id="g-nav">
                <div id="g-nav-list">
                    <ul>
                        <li><a href=""></a> <img src="../../resources/front-end/assets/img/logo11_trans3.png" alt="" style="width: 70%"></li>
                        <li><a href="#">住戶帳號</a></li>
                        <li><a href="#">社區帳單</a></li>
                        <li><a href="#">郵件</a></li>
                        <li><a href="#">公共設施</a></li>
                        <li><a href="#">活動</a></li>
                        <li><a href="#">檢舉與維修</a></li>
                        <li><a href="#">特約商店</a></li>
                    </ul>
                </div>
            </div>
            <p class="footer-logo">Community Management</p>
            <small>2022 &copy; 陪你e生e世　社區服務平台</small>
<!--            返回最上方小圖示-->
            <p id="page-top"><a href="#">Top</a></p>
        </footer>
        <!--/wrapper-->
    </div>
 <!--=============JS ===============-->
    <!--jQuery-->
    <script src="../../resources/front-end/assets/js/jquery-3.4.1.min.js"></script>
    <!--news tickerー-->
    <script src="../../resources/front-end/assets/js/jquery.bxslider.min.js"></script>
    <!--背景線延伸效果-->
    <script src="../../resources/front-end/assets/js/scrollgress.min.js"></script>
    <!--apang 動畫-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/apng-canvas/2.1.1/apng-canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <!--Tippy-->
    <script src="https://unpkg.com/popper.js@1"></script>
    <script src="https://unpkg.com/tippy.js@5"></script>

    <!--other-->
    <script src="../../resources/front-end/assets/js/modaal.min.js"></script>
    <script src="../../resources/front-end/assets/js/script.js"></script>
    <script src="../../resources/front-end/assets/js/search_origin.js"></script>




<script>





const { defineRule, Form, Field, ErrorMessage, configure } = VeeValidate
const { setLocale, loadLocaleFromURL, localize } = VeeValidateI18n
Object.keys(VeeValidateRules).forEach(rule => {
  if (rule !== 'default') {
    VeeValidate.defineRule(rule, VeeValidateRules[rule]);
  }
});
loadLocaleFromURL('https://unpkg.com/@vee-validate/i18n@4.5.7/dist/locale/zh_TW.json')

VeeValidate.configure({
  generateMessage: VeeValidateI18n.localize('zh_TW'),
  validateOnInput: true, 
});

Vue.createApp({
	
    
	
	
    components: {  
    	
    Datepicker: VueDatePicker,   
    VForm: Form,
    VField: Field,
    ErrorMessage,
  },

    data(){
        

    return{
        actType:0,
        actId : 0,
        activity:{},
        type:[],
        photo:[],
        photos:[],
    }
    },

  
    methods:{

onSubmit() {
    let web = getWeb();
 
     axios.post(web+'/activity/ActServlet?action=updateJS', {photo:this.photo,activity:this.activity })
     .then(
    		 Swal.fire({
   			  icon: 'success',
   			  title: '更新成功',
   			  showConfirmButton: false,
   				timer: 1500 
   		}).then(function(){	
   			location.reload();
   		})		 
     )
},


deletePhoto(deletePhoto){
    let web = getWeb();	
    axios.post(web+'/activity/ActPhotoServlet?action=deleteById',{id:deletePhoto})
         .then(
    		 Swal.fire({
   			  icon: 'success',
   			  title: '刪除成功',
   			  showConfirmButton: false,
   				timer: 1500 
   		}).then(function(){	
   			location.reload();
   		})		 
     )
},


        
        checkName(value){
            return (value.length>=2) ? true : "此欄位必填,最小要輸入兩個字"
        },

        checkContent(value){
            return (value.length>=6) ? true : "此欄位必填,最小要輸入五個字"
        },

        checkMax(value){
        let reg= /^\+?[1-9]{1}[0-9]{0,2}\d{0,0}$/;
        value=parseInt(value); 
        return (reg.test(value)&&(value)>this.activity.actMinCount)? true : "活動最大人數不能為零,最小下限為1,最大上限為999,最大人數不能小於最少人數"
        },

        checkMin(value){
            let reg= /^\+?[1-9]{1}[0-9]{0,2}\d{0,0}$/;
            value=parseInt(value); 
            return (reg.test(value)&&(value)<this.activity.actMaxCount)? true : "活動最小人數不能為零,最小下限為1,最大上限為999,最少人數不能大於最大人數"
        },
        
        checkDay(value){
            let currentDay = new Date();
            currentDay= moment(currentDay).format('YYYY-MM-DD')
            let signStart = this.activity.signStart
            signStart = moment(signStart).format('YYYY-MM-DD')
             return (signStart>=currentDay)? true : "此欄位必填,選擇日期不能小於今天"

        },
        
        checkSingEnd(value){
            let signStart = this.activity.signStart
            signStart = moment(signStart).format('YYYY-MM-DD')
            let signEnd = this.activity.signEnd
            signEnd = moment(signEnd).format('YYYY-MM-DD')
            return (signEnd>=signStart)? true : "選擇的日期不能小於開始報名日"
        },

        checkActStart(value){
            let signEnd = this.activity.signEnd
            signEnd = moment(signEnd).format('YYYY-MM-DD')
            let actStart = this.activity.actStart
            actStart = moment(actStart).format('YYYY-MM-DD')
            console.log(actStart)
            return (actStart>=signEnd)? true : "選擇的日期不能小於活動結束報名日"
        },

        checkEnd(value){
            let actStart = this.activity.actStart
            actStart = moment(actStart).format('YYYY-MM-DD')
            let actEnd = this.activity.actEnd
            actEnd = moment(actEnd).format('YYYY-MM-DD')
            return (actEnd>=actStart)? true : "選擇的日期不能小於活動開始報名日"
        },


        upload(fileList){
           
        let formData = new FormData();
        if(!fileList.length){ 
        return
        }else{
        for(let i=0;i<fileList.length;i++){
            file = fileList[i];
            formData.append('files[' + i + ']', file);
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload=(event)=>{
                let base64 = event.target.result
                this.photo.push(base64)
                
            }
          
        }
    }
    }
    },
    mounted(){
        let web = getWeb();
      let actId = sessionStorage.getItem("actId") 
        axios.post(web + '/activity/ActServlet?action=getOne&actId=' + actId)
                    .then((resp) => {
                        this.activity = resp.data;
                    })
        
        axios.get(web + '/activity/ActivityTypeServlet?action=getType')            
                  .then((resp)=> {
                    this.type=resp.data
                  })


         axios.get(web+'/activity/ActPhotoServlet?action=actPhoto&actId=' + actId)         
                  .then((resp)=>{
                    this.photos=resp.data
     
                  })
    }
        
    
}).mount("#app");




function getWeb(){
    let path = window.location.pathname;
	let web = path.substring(0, path.indexOf('/', 1));
    return web
}


</script>






</body>
</html>