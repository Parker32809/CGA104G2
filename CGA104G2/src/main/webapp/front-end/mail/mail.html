<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<head>
	<link rel="stylesheet" type="text/css" href="../../resources/datetimepicker/jquery.datetimepicker.css" />
	<link rel="shortcut icon" href="assets/images/logo/favicon.svg" type="image/x-icon">
	<link rel="shortcut icon" href="assets/images/logo/favicon.png" type="image/png">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.7/dist/sweetalert2.all.min.js"></script>
    <link rel="stylesheet" href="../../resources/back-end/assets/css/main/app.css">
    <meta charset="UTF-8">
    <!-- 定義為RWD web -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 最佳兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <!-- 防止搜索引擎索引及檢索 -->
    <meta name="robots" content="noindex,nofollow">

    <!-- !!固定!! 後台樣板 css start -->
    <link rel="stylesheet" href="../../resources/back-end/assets/css/main/app.css">
    <!-- !!固定!! 後台樣板 css end -->

    <!-- favicon 網址列小圖示 -->
    <link rel="shortcut icon" href="../../resources/back-end/assets/images/main/favicons/favicon2.ico" type="image/x-icon">

<!--    需要用自己的css請放在這邊註解下方覆蓋 start -->
<style>
	.btn{
		margin-left: 10px;
	}
	.form-select {
		width:11%;
		display: inline-block;
	}
	.btn-primary{
		margin-left: 400px;
	}
</style>



</head>

<body>


    <!-- 頁面 START!　網頁請從這邊以下開始修改，不需要此格式想用自己的請刪除 ~　-->

            <div id="main-content">
                    <div class="page-heading">
                        <div class="page-title">
                            <div class="row">
                                <div class="col-12 col-md-6 order-md-1 order-last">
                                    <h3>我的郵件</h3>
                                </div>
                                <div class="col-12 col-md-6 order-md-2 order-first">
                                    <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="../web/backEndHome.html">Home</a></li>
                                            <li class="breadcrumb-item active" aria-current="page">Mail Management</li>
                                        </ol>
                                    </nav>
                                </div>
                            </div>
                        </div>
                        <section class="section">
                            <div class="card">
                                <div class="card-header">
                                    <h4 class="card-title"></h4>
                                </div>
                                <div class="card-body">
                                
	                               	<div>
										<select id="select_mailType" name="select_mailType"  class="form-select">
											<option style="display: none;">請選擇</option>
										</select>
								        <input type="text" id="search_mailID" placeholder="輸入郵件編號"> <input type="button" id="searchMail" value="搜尋">
								   </div>
                                   <div id="showAllMail" class="showAllMail">
										<table id="getAllMail" class='table table_sm'>
											<tr>
												<th>郵件編號</th>
												<th>住戶編號</th>
												<th>郵件項目</th>
												<th>郵件到達日期</th>
												<th>郵件領取日期</th>
												<th>郵件狀態</th>
											</tr>
											<tr id="allMail">
						
											</tr>
										</table>

                                	</div>
                                </div>
                            </div>
                        </section>
        </div>
<!--        頁面 END-->


<!--        !!固定!! footer(擺每個頁面最下方的版權用) START-->
            <footer>
                <div class="footer clearfix mb-0 text-muted">
                    <div class="float-start">
                        <p>2022 &copy; 陪你e生e世　社區服務平台</p>
                    </div>
                    <div class="float-end">
                        <p>Community Management</p>
                    </div>
                </div>
            </footer>
<!--        !!固定!! footer END-->
                </div>
            </div>

<!-- 樣板用js start -->
<script src="../../resources/back-end/assets/js/bootstrap.js"></script>
<script src="../../resources/back-end/assets/js/app.js"></script>
<!-- 樣板用js end -->

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
	<script src="../../resources/datetimepicker/jquery.js"></script>
	<script src="../../resources/datetimepicker/jquery.datetimepicker.full.js"></script>
	<script src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
<!-- 	<script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.0.0/sweetalert2.all.js"></script> -->
<!-- 	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script> -->
<!-- 	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script> -->
<!-- 	<script type="text/javascript"></script> -->

	<script>
	
//     =====================================顯示AllMail=============================================
		window.addEventListener("load", async function (){
	            
	       	await fetch('../../back-end/mail/mail.do?action=getAll', {
				method: 'get'
			})
			.then(res => res.json())	
			.then(res =>{
				showMail(res);
			})
		})
		 
		 async function showMail(json){
	        	let mail = json;
	        	for(let i = 0; i < mail.length ; i++){
	        		let str = null;
	            	str+= "<tr><td>" + mail[i].mailId + "</td>"
	            	+"<td>" + mail[i].memberId + "</td>"
	            	+"<td>" + mail[i].mailType + "</td>"
	            	+"<td>" + mail[i].mailDelTime + "</td>"
	            	+"<td>" + ((mail[i].mailPickupTime === undefined)? " ": mail[i].mailPickupTime) +"</td>"
	            	+"<td value='"+ mail[i].mailState + "'>" + mail[i].mailStateName + "</td>";
	            	$("#allMail").after(str); 
     	 }
	}
	//  =====================================搜尋=============================================		
		 async function get() {
		    let res = await fetch("../../back-end/mail/mail.do?action=select_mailType", { method: 'get' })
		    data = await res.json()
			data.forEach(type => {
				$("#select_mailType").append(`<option value=${type.mailType}>${type.mailType}</option>`);	
			})
		 }
		
		
		document.getElementById("searchMail").onclick = async function searchMail(){
			rest();
			console.log("123");
			let select_mailType = $("#select_mailType").val();
			let search_mailID = $("#search_mailID").val();
			if(search_mailID === ""){
				search_mailID = 0;
			}
			
			let res = await fetch(`../../back-end/mail/mail.do?action=search&mailType=${select_mailType}&mailId=${search_mailID}`, { method: 'get' });
			let data = await res.json();
			 
			$("#showAllMail").append(
					`
					<table id="getAllMail" class='table table_sm'>
					<tr>
					<th>郵件編號</th>
					<th>住戶編號</th>
					<th>郵件項目</th>
					<th>郵件到達日期</th>
					<th>郵件領取日期</th>
					<th>郵件狀態</th>
					</tr>
					<tr id="allMail">
					</tr>
					</table>
					<div><input type='button' id='backButton' value='回首頁'></div>`),

					 
					 
			data.forEach(mail => {
				$("#allMail").after(
					`<tr><td> ${mail.mailId} </td>
			    	<td> ${mail.memberId} </td>
			    	<td> ${mail.mailType} </td>
			    	<td> ${mail.mailDelTime} </td>
			    	<td> ${mail.mailPickupTime === undefined ? "": mail.mailPickupTime} </td>
			    	<td value='${mail.mailState}'> ${mail.mailStateName} </td></tr>`)
			})
			document.getElementById('backButton').addEventListener('click', function(){
	        	 window.location.reload(); 
	         })
		}
		 
		
		function refresh(){
			window.location.reload(); 
		}
		get();
       	//====================================日期========================================
        $.datetimepicker.setLocale('zh');
	     $('#mailDelTime').datetimepicker({
		       theme: '',              //theme: 'dark',
		       timepicker:false,       //timepicker:true,
		       step: 1,                //step: 60 (這是timepicker的預設間隔60分鐘)
		       format:'Y-m-d',         //format:'Y-m-d H:i:s',
	     });
	     
	     
	   //====================================其他========================================
	
		function rest(){
			document.getElementById("showAllMail").innerHTML="";
		}
	   </script>
</html>